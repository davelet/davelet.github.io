---
layout: post
title: 领域驱动设计DDD入门3：子域
categories: [dev]
tags: [ddd]
---

这一节继续讲下一个战略工具：子领域，也就是小领域，简称子域。子域能用于解决和传统系统（就是老系统，会产生大泥球的系统）集成带来的复杂性问题。本节分三段：先介绍子域概念，然后是DDD项目中的子域类型，最后是使用子域解决大泥球系统。

---

- As I previously stated, within Domain-Driven Design, there are always multiple Bounded Contexts that you will use on a single project. There will be the Core Domain that you work with and there will be other Bounded Contexts that support your Core Domain in some way. Here we see the Agile Project Management Core Domain Bounded Context in the center and we have other Bounded Contexts, such as the Collaboration Context, where the Forum, Discussion, and Posts are supported, as well as Calendar and Calendar Entry. We have Tenant-User and User-Role in the Identity and Access contexts, and we have Account-Payment in another Bounded Context. Perhaps in a Product-Support Bounded Context, we have SupportPlan and Incidents and so forth. So we always have multiple Bounded Contexts within a Core Domain Project. The most optimal modeling composition is when there is just one Bounded Context per Subdomain. Now, Subdomain is a new concept to you. As we saw in the previous diagram, a Subdomain is a subportion of the Business Domain. So each of these Bounded Contexts is actually also a Subdomain and they are modeled explicitly in a one-to-one relationship with the Subdomain that they belong in. So we've actually modeled our sample project in the most optimal composition for Domain-Driven Design.

- Again a Subdomain is a sub-part of your whole business domain. The whole business domain, that is the domain of all the software within your business, is too complex to reason about and so what we like to do is divide up the whole business domain into logical Subdomains. What are the optimal areas of the business according to at least logically speaking, what would separate Bounded Contexts with their own ubiquitous languages? Now very often when we're talking about legacy systems there is a big ball of mud associated with a lot of these legacy systems and so it may not be possible to actually talk about just one explicit domain model within those legacy systems. A single legacy system may have multiple perhaps even many logical models. Each of those logical models can be referred to as a Subdomain as if they had been developed using domain driven design but they weren't. So we'll just refer to them as Subdomains. And when we are working on a specific Core Domain we will only consider the Subdomains that are used in your specific problem space. So you have a commission to carry out the design of some Core Domain and as you do so this Core Domain will need to interface and integrate with other Bounded Contexts. What we're going to do is limit our sphere of knowledge and understanding and commitment to software to just those Subdomains that are necessary to address the specific Core Domain that we're working on. That way we can basically push aside the whole business domain and all of its complexity because it's just not needed on this specific project. Think of a Subdomain also as being an area of expertise. Just like we talk about a Bounded Context and its ubiquitous language as being an area of expertise. If we think about even a big ball of mud system or application as being multiple models each of those multiple logical models is in itself a specific area of expertise. So it has strategic significance. That is the Subdomain And we need a software solution around a core model. That is the Core Domain. We have for our use as a member of our team at least one Domain Expert who is available to help us understand the vision that the business has and the goals of the domain model that we are developing. This individual have significant business experience. Enough to carry a vision and to interact with and collaborate with the entire development team. A Subdomain in a DDD Setting has a Domain Expert participating always. There is one clean Bounded Context that will serve as the Core Domain. And there are other supporting Bounded Contexts at least one other one within this modeling situation.

- So, what types of subdomains are there within the domain driven designed toolset? Here you see the core domain. This, again, is the Scrum Project Management Application. It has product backlog item release sprint, backlog items have tasks. They have volunteers, and they may have multiple estimation log entries. A release has scheduled backlog items, a sprint has committed backlog items, and there is a team product owner and team members involved. A core domain is where your organization is making a strategic investment in software. This is, at least one of, the highest priority projects within your organization or your business division. And it addresses at what your organization, your business, must excel by means of software. Understand that your business cannot excel at everything. You cannot be the best scrum project management application and the best identity and access management organization, most likely. Those are two different concerns. The Scrum Project Management Application, or service, will address specific ways for your business to be competitively advantaged within the industry of agile management tools. Your organization must excel at that. You don't want to excel at identity and access management. Perhaps you do want to excel at collaboration tools. So, it could be that the collaboration context is also a core domain for your business. But, to the core domain of the scrum application management application, the agile project management context, the collaboration context is not a core domain. It's actually a supporting domain, which we'll talk about in a moment. So, this is how your organization will distinguish itself from all others by means of this core domain. In our example, it's the scrum application management tool. Our scrum application management tool integrates with the collaboration context. And like I said, to this company, this business, the collaboration context may also be a core domain. But, in the context of the project, where the agile project management context, the scrum project management application is being developed, the collaboration context is not a core domain, it is supporting. So, a supporting sub-domain is necessary to support the core domain. It's absolutely necessary to have the supporting subdomain, or we couldn't support the features that we need for threaded discussions and calendar entries, with regard to our scrum project management application. It requires custom development, because an off-the-shelf product doesn't exist. However, it could be that this custom development should not deserve the kind of investment that the core domain gets. Now, this is a decision that the organization will have to make. If there is strategic significance, for example, with, or associated with, the collaboration context, then you will put significant development into it. But still, regarding the scrum project management application, the agile project management context, collaboration is still a supporting subdomain to it. If there is no strategic significance in a supporting subdomain to a specific core domain, then you may want to consider outsourcing its development, or making sure that you don't heavily invest in it as you would a core domain. Again, this is a decision that your organization, your business, will have to determine. What about a generic subdomain? Such as the identity and access subdomain. Where tenant, user, and role are identified and modeled. Again, you do not want to put the same investment into a generic subdomain, as you do the core domain. So, it's necessary, you cannot have the scrum project management application without the identity and access context. But, it's still generic. You do not want to invest heavily in a generic subdomain. In fact, it may be possible to purchase this specific kind of software off-the-shelf, or it could be outsourced to make certain that you do not invest heavily in the software. If it is developed in-house, if you decide that it shouldn't be outsourced, and if you cannot find or afford an off-the-shelf solution, then this generic subdomain should be assigned to developers who do not have the same elite skills as those who you would employ on the team for a core subdomain team.

- It's probably inevitable that you will face a big ball of mud at some point as you're using domain-driven design. So, while you're developing your core domain, and this core domain is being developed using DDD techniques with an explicit, bounded context and ubiquitous language, you will probably still have to integrate with a big ball of mud at some point. How can you deal with the complexity of integrating with the big ball of mud. Remember that there are most likely multiple logical models represented inside the big ball of mud. If DDD had been used to develop what became a big ball of mud, you probably would've had at least multiple bounded contexts; maybe several bounded contexts. But that wasn't the case. We can only wish for that, and so we have to find a way to deal with the complexity of the big ball of mud. As we're working in our problem space; that is trying to understand and make sense of the the big ball of mud, we can treat each of the logical models within the big ball of mud as if they were their own bounded context. So we have, for example, an orders subdomain. We have a fulfillment subdomain, an accounts subdomain, a catalog subdomain and a shipping subdomain. As you're working in your problem space trying to understand this big ball of mud by naming each of the subdomains, we are identifying what we wish were separate explicit bounded contexts. Even though we don't have them, we can still tackle the complexity of using this big ball of mud by being able to understand the subdomains within. So as you are doing analysis and high-level strategic design, mark off a big ball of mud according to the logical models that exist within it. It will help a lot to deal with the complexity. Now back to our core domain; the agile project management context. This is in a subdomain of its own. It is the agile project management subdomain. We have a one-to-one relationship between the subdomain and the bounded context and the bounded context to its subdomain. We also have one supporting domain and one generic subdomain. The supporting subdomain is the collaboration context, and the collaboration context is supporting because we can't buy it off the shelf, at least not for the features that we need to support the agile project management context. So we're going to develop the collaboration context in house. It could be that this collaboration context is worthy of putting investment in as a core domain. However, relative to the agile project management context, the collaboration context is just a supporting subdomain. On the other side we have a generic subdomain; the Identity and Access Context. This subdomain and its bounded context are aligned one-to-one just like the other two subdomains and their bounded contexts. So it is the ideal modeling composition for domain-driven design, but, note again, this is a generic subdomain so its bounded context does not deserve the kind of strategic investment that is needed for a core domain. So we don't want to put this kind of investment into it. Again, overall, we've achieved the most ideal modeling composition with a single subdomain and a single bounded context even though the two... both supporting and the generic subdomain do not have a strategic... necessarily a strategic investment in them.

- [Instructor] In summary you learned what subdomains are and how they are used, both in the problem space and in the solution space, the differences between a core domain and a supporting subdomain and a generic subdomain. You also learned how you can make use of subdomains while reasoning about the integration with a Big Ball of Mud legacy system, and you learned the importance of aligning your DDD bounded context one-to-one with a single subdomain.

